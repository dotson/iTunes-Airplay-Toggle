<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>bundleid</key>
	<string>com.dotson.airplaytoggle</string>
	<key>category</key>
	<string>Tools</string>
	<key>connections</key>
	<dict>
		<key>02000A10-FAFC-41D3-A631-4A2DFE3472ED</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>5FCDDED3-9F96-4685-B23B-0E3A3D2AC8A3</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>09BE490C-0DE2-47EB-B461-5A574FBD3E1C</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>2824B118-BE32-4712-8640-01D08915BB33</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>20241E62-546E-4F1B-B49F-4917E4B9A948</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>2824B118-BE32-4712-8640-01D08915BB33</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>81C4695E-362D-4054-A2B1-A9FE73165236</string>
				<key>modifiers</key>
				<integer>524288</integer>
				<key>modifiersubtext</key>
				<string>Select to temporarily use alternate action.</string>
				<key>vitoclose</key>
				<false/>
			</dict>
			<dict>
				<key>destinationuid</key>
				<string>42E0EBB5-CA9D-4DDE-99B4-FCE714370E98</string>
				<key>modifiers</key>
				<integer>262144</integer>
				<key>modifiersubtext</key>
				<string>Action a device without closing Alfred. Works best with 'toggle' mode.</string>
				<key>vitoclose</key>
				<true/>
			</dict>
			<dict>
				<key>destinationuid</key>
				<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>38FF712E-4862-4573-8F73-9F604CC6B091</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>42E0EBB5-CA9D-4DDE-99B4-FCE714370E98</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>81C4695E-362D-4054-A2B1-A9FE73165236</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>EB786CAF-8AA6-4866-A84C-B7301B3357F7</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
	</dict>
	<key>createdby</key>
	<string>C. Dotson</string>
	<key>description</key>
	<string>Toggle the state of your Airplay devices.</string>
	<key>disabled</key>
	<false/>
	<key>name</key>
	<string>iTunes Airplay Toggle</string>
	<key>objects</key>
	<array>
		<dict>
			<key>config</key>
			<dict>
				<key>argument</key>
				<string>{query}</string>
				<key>passthroughargument</key>
				<true/>
				<key>variables</key>
				<dict>
					<key>alt</key>
					<string>true</string>
				</dict>
			</dict>
			<key>type</key>
			<string>alfred.workflow.utility.argument</string>
			<key>uid</key>
			<string>81C4695E-362D-4054-A2B1-A9FE73165236</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>type</key>
			<string>alfred.workflow.utility.junction</string>
			<key>uid</key>
			<string>42E0EBB5-CA9D-4DDE-99B4-FCE714370E98</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>alfredfiltersresults</key>
				<false/>
				<key>alfredfiltersresultsmatchmode</key>
				<integer>0</integer>
				<key>argumenttreatemptyqueryasnil</key>
				<false/>
				<key>argumenttrimmode</key>
				<integer>0</integer>
				<key>argumenttype</key>
				<integer>2</integer>
				<key>escaping</key>
				<integer>4</integer>
				<key>keyword</key>
				<string>{var:workflow_keyword}</string>
				<key>queuedelaycustom</key>
				<integer>1</integer>
				<key>queuedelayimmediatelyinitially</key>
				<false/>
				<key>queuedelaymode</key>
				<integer>0</integer>
				<key>queuemode</key>
				<integer>1</integer>
				<key>runningsubtext</key>
				<string>Getting available Airplay devices...</string>
				<key>script</key>
				<string>set workflowFolder to do shell script "pwd"set wlib to load script POSIX file (workflowFolder &amp; "/q_workflow.scpt")set wf to wlib's new_workflow()set action to (system attribute "default_action")if action is "toggle" then	set action to "Toggle Each"else	set action to "Select One"end ifadd_result of wf without isValid given theUid:"", theArg:"", theTitle:"Available AirPlay Devices:", theAutocomplete:"", theSubtitle:"Select to toggle state via default method: " &amp; action, theIcon:"icon.png", theType:"", theQuicklookurl:""tell application "Music"		set apDevices to (get name of every AirPlay device)	set apNames to {}	set apSelectedBool to {}	set apSelected to {}		repeat with i from 1 to length of apDevices		set thisDevice to item i of apDevices				set thisName to thisDevice as string		set the end of apNames to thisName		set thisBool to selected of AirPlay device thisDevice		set the end of apSelectedBool to thisBool		if thisBool is true then			set thisSel to "On"			set the end of apSelected to thisSel		else			set thisSel to "Off"			set the end of apSelected to thisSel		end if				add_result of wf with isValid given theUid:"", theArg:thisName, theTitle:thisName, theAutocomplete:"", theSubtitle:"Current State: " &amp; thisSel, theIcon:"icon.png", theType:"", theQuicklookurl:""			end repeat	end tellwf's to_xml("")</string>
				<key>scriptargtype</key>
				<integer>1</integer>
				<key>scriptfile</key>
				<string>DeviceSearch.applescript</string>
				<key>subtext</key>
				<string>Toggle the playing state of your Airplay devices.</string>
				<key>title</key>
				<string>iTunes Airplay Toggle</string>
				<key>type</key>
				<integer>8</integer>
				<key>withspace</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.input.scriptfilter</string>
			<key>uid</key>
			<string>2824B118-BE32-4712-8640-01D08915BB33</string>
			<key>version</key>
			<integer>3</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>action</key>
				<integer>0</integer>
				<key>argument</key>
				<integer>0</integer>
				<key>focusedappvariable</key>
				<false/>
				<key>focusedappvariablename</key>
				<string></string>
				<key>hotkey</key>
				<integer>0</integer>
				<key>hotmod</key>
				<integer>1179648</integer>
				<key>hotstring</key>
				<string>A</string>
				<key>leftcursor</key>
				<false/>
				<key>modsmode</key>
				<integer>0</integer>
				<key>relatedAppsMode</key>
				<integer>0</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.trigger.hotkey</string>
			<key>uid</key>
			<string>09BE490C-0DE2-47EB-B461-5A574FBD3E1C</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>lastpathcomponent</key>
				<false/>
				<key>onlyshowifquerypopulated</key>
				<false/>
				<key>removeextension</key>
				<false/>
				<key>text</key>
				<string>{query}</string>
				<key>title</key>
				<string>Airplay Device Updated</string>
			</dict>
			<key>type</key>
			<string>alfred.workflow.output.notification</string>
			<key>uid</key>
			<string>5FCDDED3-9F96-4685-B23B-0E3A3D2AC8A3</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>4</integer>
				<key>script</key>
				<string>set query to "{query}"

set workflowFolder to do shell script "pwd"
set wlib to load script POSIX file (workflowFolder &amp; "/q_workflow.scpt")
set wf to wlib's new_workflow()

set action to (system attribute "default_action")
set alt to (system attribute "alt")

if alt is "true" then
	if action is "toggle" then set action to "select"
else if action is "select" then
	set action to "toggle"
end if

tell application "Music"
	
	set apDevices to (get name of every AirPlay device)
	
	-- Toggle Action
	if action is "toggle" then
		
		repeat with i from 1 to length of apDevices
			set thisDevice to (item i of apDevices) as string
			
			if thisDevice is query then
				set oldState to selected of AirPlay device thisDevice
				set newState to (not oldState)
				set selected of AirPlay device thisDevice to newState
				if newState is true then
					set newState to "On"
				else
					set newState to "Off"
				end if
				
				return thisDevice &amp; ": " &amp; newState
				
			end if
		end repeat
	end if
	
	-- Select Action
	if action is "select" then
		
        -- Two loops needed. Turn the chosen device ON then turn off all remaining devices
		repeat with i from 1 to length of apDevices
			set thisDevice to (item i of apDevices) as string
			if thisDevice is query then
				set selected of AirPlay device thisDevice to true
			end if
		end repeat
		
		repeat with i from 1 to length of apDevices
			set thisDevice to (item i of apDevices) as string
			if thisDevice is not query then
				set selected of AirPlay device thisDevice to false
			end if
		end repeat
		
		return query &amp; " is now selected."
	end if
	
end tell</string>
				<key>scriptargtype</key>
				<integer>1</integer>
				<key>scriptfile</key>
				<string>DeviceChange.applescript</string>
				<key>type</key>
				<integer>8</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>02000A10-FAFC-41D3-A631-4A2DFE3472ED</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>argument</key>
				<string>Computer</string>
				<key>argumenttype</key>
				<integer>3</integer>
				<key>triggerid</key>
				<string>aptoggle1</string>
				<key>triggername</key>
				<string>Computer</string>
				<key>workflowonly</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.trigger.remote</string>
			<key>uid</key>
			<string>20241E62-546E-4F1B-B49F-4917E4B9A948</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>argument</key>
				<string>Stereo</string>
				<key>argumenttype</key>
				<integer>3</integer>
				<key>triggerid</key>
				<string>aptoggle2</string>
				<key>triggername</key>
				<string>Stereo</string>
				<key>workflowonly</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.trigger.remote</string>
			<key>uid</key>
			<string>38FF712E-4862-4573-8F73-9F604CC6B091</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>argument</key>
				<string>Apple TV</string>
				<key>argumenttype</key>
				<integer>3</integer>
				<key>triggerid</key>
				<string>aptoggle3</string>
				<key>triggername</key>
				<string>Apple TV</string>
				<key>workflowonly</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.trigger.remote</string>
			<key>uid</key>
			<string>EB786CAF-8AA6-4866-A84C-B7301B3357F7</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
	</array>
	<key>readme</key>
	<string># iTunes Airplay Toggle

*Alfred Workflow to toggle the playing state of your Airplay devices.*

**Starting with version 1.7.0, this workflow is compatible with the Alfred Workflow Gallery.**

The default method is "toggle". This will toggle the state for only the selected device. The typical use for this would be if you have more than one device that you like to have turned ON at the same time (i.e., listening in the main room and a second room).

If you prefer to use only one device at a time, change the default method in the variable window to "select". This will toggle ON the selected device and toggle OFF all the others. The typical use for this would be if you prefer to listen on only one device at a time (i.e., listening through computer speakers or headphones).

Two modifier actions are provided:
1. You can choose to use the non-default method at any time by actioning on the device while pressing the 'option' key. This will cause Alfred to run whichever method is not the default.
2. Holding 'control' will allow you to action a device without closing the Alfred window. This works well if you're often toggling more than one device at a time. The 'esc' key will need to be hit when you're done.</string>
	<key>uidata</key>
	<dict>
		<key>02000A10-FAFC-41D3-A631-4A2DFE3472ED</key>
		<dict>
			<key>xpos</key>
			<real>605</real>
			<key>ypos</key>
			<real>190</real>
		</dict>
		<key>09BE490C-0DE2-47EB-B461-5A574FBD3E1C</key>
		<dict>
			<key>xpos</key>
			<real>30</real>
			<key>ypos</key>
			<real>185</real>
		</dict>
		<key>20241E62-546E-4F1B-B49F-4917E4B9A948</key>
		<dict>
			<key>colorindex</key>
			<integer>7</integer>
			<key>xpos</key>
			<real>205</real>
			<key>ypos</key>
			<real>300</real>
		</dict>
		<key>2824B118-BE32-4712-8640-01D08915BB33</key>
		<dict>
			<key>xpos</key>
			<real>205</real>
			<key>ypos</key>
			<real>185</real>
		</dict>
		<key>38FF712E-4862-4573-8F73-9F604CC6B091</key>
		<dict>
			<key>colorindex</key>
			<integer>7</integer>
			<key>xpos</key>
			<real>205</real>
			<key>ypos</key>
			<real>420</real>
		</dict>
		<key>42E0EBB5-CA9D-4DDE-99B4-FCE714370E98</key>
		<dict>
			<key>xpos</key>
			<real>445</real>
			<key>ypos</key>
			<real>175</real>
		</dict>
		<key>5FCDDED3-9F96-4685-B23B-0E3A3D2AC8A3</key>
		<dict>
			<key>xpos</key>
			<real>770</real>
			<key>ypos</key>
			<real>190</real>
		</dict>
		<key>81C4695E-362D-4054-A2B1-A9FE73165236</key>
		<dict>
			<key>xpos</key>
			<real>445</real>
			<key>ypos</key>
			<real>115</real>
		</dict>
		<key>EB786CAF-8AA6-4866-A84C-B7301B3357F7</key>
		<dict>
			<key>colorindex</key>
			<integer>7</integer>
			<key>note</key>
			<string>Examples of Remote trigger inputs that can be added to the Alfred iOS app</string>
			<key>xpos</key>
			<real>205</real>
			<key>ypos</key>
			<real>540</real>
		</dict>
	</dict>
	<key>userconfigurationconfig</key>
	<array>
		<dict>
			<key>config</key>
			<dict>
				<key>default</key>
				<string>airtog</string>
				<key>placeholder</key>
				<string></string>
				<key>required</key>
				<true/>
				<key>trim</key>
				<true/>
			</dict>
			<key>description</key>
			<string>Choose a keyword to trigger the workflow.</string>
			<key>label</key>
			<string>Workflow Keyword</string>
			<key>type</key>
			<string>textfield</string>
			<key>variable</key>
			<string>workflow_keyword</string>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>default</key>
				<string>toggle</string>
				<key>pairs</key>
				<array>
					<array>
						<string>Toggle Each</string>
						<string>toggle</string>
					</array>
					<array>
						<string>Select One</string>
						<string>select</string>
					</array>
				</array>
			</dict>
			<key>description</key>
			<string>Toggle Each allows you to have more than one device on at a time. Select One turns on only the device you select.</string>
			<key>label</key>
			<string>Default Action Type</string>
			<key>type</key>
			<string>popupbutton</string>
			<key>variable</key>
			<string>default_action</string>
		</dict>
	</array>
	<key>version</key>
	<string>1.7.0</string>
	<key>webaddress</key>
	<string>https://github.com/dotson/iTunes-Airplay-Toggle</string>
</dict>
</plist>
